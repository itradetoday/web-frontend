<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NQ Risk Profiler Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        html::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='6.5' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.06'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 10000;
            mix-blend-mode: overlay;
            animation: grain 8s steps(10) infinite;
        }
        @keyframes grain {
            0%, 100% { transform: translate(0, 0); }
            10% { transform: translate(-5%, -10%); }
            20% { transform: translate(-15%, 5%); }
            30% { transform: translate(7%, -25%); }
            40% { transform: translate(-5%, 25%); }
            50% { transform: translate(-15%, 10%); }
            60% { transform: translate(15%, 0%); }
            70% { transform: translate(0%, 15%); }
            80% { transform: translate(3%, 25%); }
            90% { transform: translate(-10%, 10%); }
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #000000;
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        #spotlight {
            position: fixed;
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(200, 255, 0, 0.08) 0%, transparent 70%);
            pointer-events: none;
            z-index: 5;
            transition: all 0.3s ease;
            mix-blend-mode: screen;
        }
        </style>
    </head>
    <body>
        <div id="spotlight"></div>
        <script>
        document.addEventListener('mousemove', (e) => {
            const spotlight = document.getElementById('spotlight');
            spotlight.style.left = (e.clientX - 400) + 'px';
            spotlight.style.top = (e.clientY - 400) + 'px';
        });
        </script>
        <style>
        ::selection {
            background: rgba(200, 255, 0, 0.3);
            color: #fff;
        }
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #000;
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #C8FF00, #00FF88);
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #D4FF33, #00FF88);
        }
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(200, 255, 0, 0.04) 0%, transparent 25%),
                radial-gradient(circle at 80% 80%, rgba(200, 255, 0, 0.03) 0%, transparent 25%),
                radial-gradient(circle at 40% 20%, rgba(0, 200, 255, 0.03) 0%, transparent 25%),
                radial-gradient(circle at 60% 60%, rgba(0, 255, 136, 0.02) 0%, transparent 25%);
            animation: pulse 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }
        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background: radial-gradient(ellipse at center, transparent 0%, rgba(0, 0, 0, 0.7) 100%);
            pointer-events: none;
            z-index: 2;
        }
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(2px 2px at 20% 30%, rgba(200, 255, 0, 0.3), transparent),
                radial-gradient(2px 2px at 60% 70%, rgba(0, 255, 136, 0.3), transparent),
                radial-gradient(1px 1px at 50% 50%, rgba(0, 200, 255, 0.3), transparent),
                radial-gradient(1px 1px at 80% 10%, rgba(200, 255, 0, 0.3), transparent),
                radial-gradient(2px 2px at 90% 60%, rgba(0, 255, 136, 0.2), transparent),
                radial-gradient(1px 1px at 33% 90%, rgba(200, 255, 0, 0.3), transparent),
                radial-gradient(2px 2px at 15% 80%, rgba(0, 200, 255, 0.2), transparent),
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 0l25.98 15v30L30 60 4.02 45V15z' fill='none' stroke='rgba(200,255,0,0.02)' stroke-width='0.5'/%3E%3C/svg%3E");
            background-size: 200% 200%, 200% 200%, 200% 200%, 200% 200%, 200% 200%, 200% 200%, 200% 200%, 60px 60px;
            background-position: 0% 0%, 100% 100%, 50% 50%, 80% 10%, 90% 60%, 33% 90%, 15% 80%, 0 0;
            pointer-events: none;
            z-index: 1;
            animation: floatingParticles 20s ease-in-out infinite;
        }
        @keyframes floatingParticles {
            0%, 100% { 
                background-position: 0% 0%, 100% 100%, 50% 50%, 80% 10%, 90% 60%, 33% 90%, 15% 80%, 0 0;
                opacity: 0.4;
            }
            50% { 
                background-position: 100% 100%, 0% 0%, 80% 20%, 20% 90%, 10% 40%, 66% 10%, 85% 20%, 20px 20px;
                opacity: 0.7;
            }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.4; }
            50% { transform: scale(1.1) rotate(5deg); opacity: 0.6; }
        }
        .container { 
            max-width: 1500px; 
            margin: 0 auto; 
            position: relative; 
            z-index: 1; 
        }
        .container::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15) 0px,
                transparent 1px,
                transparent 2px,
                rgba(0, 0, 0, 0.15) 3px
            );
            pointer-events: none;
            z-index: 9999;
            animation: scanlines 8s linear infinite;
        }
        .container::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 100vh;
            background: linear-gradient(
                180deg,
                transparent 0%,
                rgba(200, 255, 0, 0.03) 50%,
                transparent 100%
            );
            pointer-events: none;
            z-index: 9998;
            animation: cinematicSweep 4s ease-in-out infinite;
        }
        @keyframes scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(10px); }
        }
        @keyframes cinematicSweep {
            0%, 100% { transform: translateY(-100%); opacity: 0; }
            50% { transform: translateY(100%); opacity: 1; }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card {
            background: linear-gradient(135deg, rgba(18, 18, 18, 0.85) 0%, rgba(25, 25, 25, 0.85) 100%);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(200, 255, 0, 0.1);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 24px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            animation: slideIn 0.6s ease-out;
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
            perspective: 1000px;
        }
        .card::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(200, 255, 0, 0.05), transparent);
            transition: left 0.6s;
        }
        .card:hover::after {
            left: 100%;
        }
        .card:hover {
            transform: translateY(-4px) rotateX(2deg);
            border-color: rgba(200, 255, 0, 0.3);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.6),
                0 0 0 1px rgba(200, 255, 0, 0.2),
                0 0 80px rgba(200, 255, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.08),
                inset -100px -100px 100px rgba(200, 255, 0, 0.02);
        }
        .card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(200, 255, 0, 0.3) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
            filter: blur(20px);
        }
        .card:hover::before {
            opacity: 1;
            animation: lensFlare 2s ease-in-out;
        }
        @keyframes lensFlare {
            0% { transform: translate(0, 0) scale(0); }
            50% { transform: translate(-100px, 100px) scale(1); }
            100% { transform: translate(-200px, 200px) scale(0); }
        }
        .card-header { 
            font-size: 22px; 
            font-weight: 500; 
            margin-bottom: 28px; 
            color: #FFFFFF;
            display: flex;
            align-items: center;
            gap: 16px;
            letter-spacing: -0.3px;
            text-transform: none;
            position: relative;
            padding-left: 20px;
        }
        .card-header::before {
            content: '';
            position: absolute;
            left: 0;
            width: 4px;
            height: 24px;
            background: linear-gradient(180deg, #C8FF00, #00FF88);
            border-radius: 2px;
            box-shadow: 
                0 0 20px rgba(200, 255, 0, 0.6),
                0 0 40px rgba(200, 255, 0, 0.3);
            animation: lightning 2s ease-in-out infinite;
        }
        @keyframes lightning {
            0%, 100% { 
                opacity: 1;
                box-shadow: 0 0 20px rgba(200, 255, 0, 0.6), 0 0 40px rgba(200, 255, 0, 0.3);
            }
            50% { 
                opacity: 0.7;
                box-shadow: 0 0 30px rgba(200, 255, 0, 0.8), 0 0 60px rgba(200, 255, 0, 0.5);
            }
        }
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .input-group { display: flex; flex-direction: column; gap: 10px; }
        .input-group label {
            font-size: 12px;
            font-weight: 500;
            color: #FFFFFF;
            letter-spacing: 0px;
            text-transform: none;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        .input-group label::before {
            content: '';
            display: none;
        }
        .input-group {
            position: relative;
        }
        .input-group::before {
            content: '';
            position: absolute;
            inset: -1px;
            background: linear-gradient(135deg, #C8FF00, #00FF88, #C8FF00);
            background-size: 200% 200%;
            border-radius: 4px;
            opacity: 0;
            transition: opacity 0.3s;
            animation: gradientRotate 3s linear infinite;
            z-index: -1;
        }
        .input-group:focus-within::before {
            opacity: 1;
        }
        @keyframes gradientRotate {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .input-group input {
            background: rgba(30, 30, 30, 0.95);
            border: 1px solid rgba(139, 139, 139, 0.3);
            border-radius: 4px;
            padding: 14px 16px;
            color: #fff;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: none;
            position: relative;
            z-index: 1;
        }
        .input-group input:focus {
            outline: none;
            border-color: transparent;
            background: rgba(20, 20, 20, 1);
            box-shadow: 0 0 0 3px rgba(200, 255, 0, 0.2), inset 0 0 20px rgba(200, 255, 0, 0.05);
        }
        .input-group input:hover { 
            border-color: rgba(200, 255, 0, 0.5);
            background: rgba(25, 25, 25, 1);
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
        }
        .metric-box {
            background: linear-gradient(135deg, rgba(30, 30, 30, 0.9) 0%, rgba(35, 35, 35, 0.9) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(200, 255, 0, 0.1);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }
        .metric-box:nth-child(2n) {
            animation-delay: 0.5s;
        }
        .metric-box:nth-child(3n) {
            animation-delay: 1s;
        }
        .metric-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #C8FF00, transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .metric-box::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 16px;
            padding: 1px;
            background: linear-gradient(135deg, rgba(200, 255, 0, 0.3), rgba(0, 200, 255, 0.2));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.4s;
        }
        .metric-box:hover {
            transform: translateY(-8px) scale(1.03);
            border-color: rgba(200, 255, 0, 0.4);
            animation: none;
            box-shadow: 
                0 16px 40px rgba(200, 255, 0, 0.25),
                0 0 80px rgba(200, 255, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                -2px -2px 0 rgba(255, 0, 0, 0.2),
                2px 2px 0 rgba(0, 255, 255, 0.2);
            filter: brightness(1.1);
        }
        .metric-box:hover::before { opacity: 1; }
        .metric-box:hover::after { opacity: 1; }
        .metric-label {
            font-size: 11px;
            color: #FFFFFF;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .metric-value {
            font-size: 32px;
            font-weight: 600;
            line-height: 1;
            background: linear-gradient(135deg, #C8FF00 0%, #A0FF00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: none;
            filter: drop-shadow(0 0 20px rgba(200, 255, 0, 0.3));
            animation: valueGlow 2s ease-in-out infinite;
        }
        @keyframes valueGlow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(200, 255, 0, 0.2)); }
            50% { filter: drop-shadow(0 0 25px rgba(200, 255, 0, 0.4)); }
        }
        .grade-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }
        .grade-box {
            background: rgba(30, 30, 30, 0.95);
            border: 1px solid rgba(200, 255, 0, 0.15);
            border-radius: 12px;
            padding: 24px;
            transition: all 0.3s;
        }
        .grade-box:hover {
            border-color: rgba(200, 255, 0, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(200, 255, 0, 0.1);
        }
        .grade-title {
            font-size: 16px;
            color: #FFFFFF;
            margin-bottom: 18px;
            font-weight: 600;
            text-transform: none;
            letter-spacing: 0px;
        }
        .grade-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 15px;
            padding: 12px;
            background: rgba(20, 20, 20, 0.8);
            border-radius: 8px;
            transition: all 0.3s;
            border: 1px solid rgba(200, 255, 0, 0.05);
            position: relative;
            overflow: hidden;
        }
        .grade-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(200, 255, 0, 0.1), transparent);
            transition: left 0.5s;
        }
        .grade-item:hover::before {
            left: 100%;
        }
        .grade-item:hover {
            background: rgba(30, 30, 30, 0.9);
            transform: translateX(8px) scale(1.02);
            border-color: rgba(200, 255, 0, 0.3);
            box-shadow: 
                -4px 0 20px rgba(200, 255, 0, 0.2),
                inset 0 0 20px rgba(200, 255, 0, 0.05);
        }
        .grade-item strong {
            font-weight: 900;
            font-size: 20px;
            padding: 6px 16px;
            border-radius: 8px;
            position: relative;
            text-shadow: 0 0 10px currentColor;
            overflow: hidden;
        }
        .grade-item strong::before {
            content: '';
            position: absolute;
            top: -100%;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, transparent, currentColor, transparent);
            opacity: 0.2;
            animation: digitalRain 2s linear infinite;
        }
        @keyframes digitalRain {
            0% { top: -100%; }
            100% { top: 100%; }
        }
        .grade-a { 
            color: #00FF88; 
            background: rgba(0, 255, 136, 0.1); 
            box-shadow: 
                0 0 20px rgba(0, 255, 136, 0.3),
                inset 0 0 20px rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            animation: gradeGlow 2s ease-in-out infinite;
        }
        @keyframes gradeGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 255, 136, 0.3), inset 0 0 20px rgba(0, 255, 136, 0.1); }
            50% { box-shadow: 0 0 30px rgba(0, 255, 136, 0.5), inset 0 0 30px rgba(0, 255, 136, 0.2); }
        }
        .grade-b { 
            color: #00C8FF; 
            background: rgba(0, 200, 255, 0.1); 
            box-shadow: 
                0 0 20px rgba(0, 200, 255, 0.3),
                inset 0 0 20px rgba(0, 200, 255, 0.1);
            border: 1px solid rgba(0, 200, 255, 0.3);
        }
        .grade-c { 
            color: #FFD700; 
            background: rgba(255, 215, 0, 0.1); 
            box-shadow: 
                0 0 20px rgba(255, 215, 0, 0.3),
                inset 0 0 20px rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        .grade-d { 
            color: #FF8C00; 
            background: rgba(255, 140, 0, 0.1); 
            box-shadow: 
                0 0 20px rgba(255, 140, 0, 0.3),
                inset 0 0 20px rgba(255, 140, 0, 0.1);
            border: 1px solid rgba(255, 140, 0, 0.3);
        }
        .grade-f { 
            color: #FF3232; 
            background: rgba(255, 50, 50, 0.1); 
            box-shadow: 
                0 0 20px rgba(255, 50, 50, 0.3),
                inset 0 0 20px rgba(255, 50, 50, 0.1);
            border: 1px solid rgba(255, 50, 50, 0.3);
        }
        .btn {
            background: linear-gradient(135deg, #C8FF00 0%, #B8EF00 100%);
            color: #000;
            border: none;
            border-radius: 24px;
            padding: 12px 24px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 4px 16px rgba(200, 255, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            letter-spacing: 0px;
            position: relative;
            overflow: hidden;
            animation: buttonGlow 2s ease-in-out infinite;
        }
        @keyframes buttonGlow {
            0%, 100% { 
                box-shadow: 
                    0 4px 16px rgba(200, 255, 0, 0.3),
                    0 0 20px rgba(200, 255, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }
            50% { 
                box-shadow: 
                    0 4px 20px rgba(200, 255, 0, 0.5),
                    0 0 40px rgba(200, 255, 0, 0.4),
                    inset 0 1px 0 rgba(255, 255, 255, 0.3);
            }
        }
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .btn::after {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(45deg, #C8FF00, #00FF88, #C8FF00);
            background-size: 300% 300%;
            border-radius: 24px;
            z-index: -1;
            animation: borderFlow 3s ease infinite;
            opacity: 0;
        }
        @keyframes borderFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .btn:hover::before {
            width: 300px;
            height: 300px;
        }
        .btn:hover::after {
            opacity: 0.6;
        }
        .btn:hover { 
            background: linear-gradient(135deg, #D4FF33 0%, #C8FF00 100%);
            transform: translateY(-3px) scale(1.03);
            box-shadow: 
                0 8px 32px rgba(200, 255, 0, 0.6),
                0 0 60px rgba(200, 255, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            animation: none;
        }
        .btn-secondary {
            background: rgba(200, 255, 0, 0.08);
            color: #C8FF00;
            border: 1px solid rgba(200, 255, 0, 0.3);
            box-shadow: none;
            animation: none;
        }
        .btn-secondary::before { display: none; }
        .btn-secondary::after { display: none; }
        .btn-secondary:hover { 
            background: rgba(200, 255, 0, 0.15);
            border-color: rgba(200, 255, 0, 0.5);
            box-shadow: 
                0 4px 20px rgba(200, 255, 0, 0.3),
                inset 0 0 30px rgba(200, 255, 0, 0.15);
        }
        .btn-group { display: flex; gap: 16px; flex-wrap: wrap; }
        .chart-container {
            height: 360px;
            margin-top: 20px;
            position: relative;
            border-radius: 16px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(30, 30, 30, 0.9) 0%, rgba(20, 20, 20, 0.9) 100%);
            border: 1px solid rgba(200, 255, 0, 0.15);
            box-shadow: inset 0 0 40px rgba(200, 255, 0, 0.03);
        }
        .chart-container::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 20px;
            right: 20px;
            height: 2px;
            background: linear-gradient(90deg, transparent, #C8FF00, transparent);
            opacity: 0.5;
        }
        .chart-container::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 20px;
            right: 20px;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00FF88, transparent);
            opacity: 0.5;
        }
        .tab-container {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            padding: 8px;
            background: linear-gradient(135deg, rgba(30, 30, 30, 0.9) 0%, rgba(20, 20, 20, 0.9) 100%);
            border-radius: 24px;
            border: 1px solid rgba(200, 255, 0, 0.15);
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.5);
        }
        .tab {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            color: #8B8B8B;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            border-radius: 20px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: 0px;
            text-transform: none;
            position: relative;
            overflow: hidden;
        }
        .tab::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(200, 255, 0, 0.1), rgba(0, 255, 136, 0.1));
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tab:hover {
            background: rgba(200, 255, 0, 0.08);
            color: #C8FF00;
            transform: translateY(-1px);
        }
        .tab:hover::before {
            opacity: 1;
        }
        .tab.active {
            background: linear-gradient(135deg, #C8FF00, #00FF88);
            color: #000;
            box-shadow: 
                0 4px 20px rgba(200, 255, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            transform: scale(1.02);
        }
        .tab.active::before {
            display: none;
        }
        .chart-panel { display: none; animation: slideIn 0.4s ease-out; }
        .chart-panel.active { display: block; }
        @media (max-width: 768px) {
            .metrics-grid { grid-template-columns: repeat(2, 1fr); }
            .input-grid { grid-template-columns: 1fr; }
            .grade-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 50px; flex-wrap: wrap; gap: 20px; padding: 20px; background: linear-gradient(135deg, rgba(30, 30, 30, 0.6) 0%, rgba(20, 20, 20, 0.6) 100%); backdrop-filter: blur(20px); border-radius: 20px; border: 1px solid rgba(200, 255, 0, 0.1); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);">
            <div style="display: flex; align-items: center; gap: 30px; flex-wrap: wrap;">
                <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #C8FF00, #00FF88); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: 900; color: #000; box-shadow: 0 8px 24px rgba(200, 255, 0, 0.4); animation: logoSpin 3s ease-in-out infinite; position: relative; overflow: hidden;">
                    <div style="position: absolute; inset: -50%; background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%); animation: holographic 3s linear infinite;"></div>
                    <span style="position: relative; z-index: 1;">NQ</span>
                </div>
                <style>
                @keyframes holographic {
                    0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
                    100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
                }
                </style>
                <div>
                    <h1 id="mainTitle" style="font-size: 52px; font-weight: 400; background: linear-gradient(135deg, #C8FF00 0%, #00FF88 50%, #C8FF00 100%); background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; letter-spacing: -1.5px; animation: gradientShift 3s ease infinite; position: relative; cursor: pointer;">NQ Risk Profiler</h1>
                </div>
                <script>
                const title = document.getElementById('mainTitle');
                title.addEventListener('mouseenter', function() {
                    this.style.animation = 'gradientShift 3s ease infinite, glitchTitle 0.5s ease-in-out';
                });
                title.addEventListener('mouseleave', function() {
                    this.style.animation = 'gradientShift 3s ease infinite';
                });
                </script>
                <style>
                @keyframes glitchTitle {
                    0%, 100% { transform: translate(0); }
                    20% { transform: translate(-2px, 2px); }
                    40% { transform: translate(-2px, -2px); }
                    60% { transform: translate(2px, 2px); }
                    80% { transform: translate(2px, -2px); }
                }
                </style>
            </div>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="exportResults()">üìä EXPORT TO EXCEL</button>
                <button class="btn btn-secondary" onclick="reset()">üîÑ RESET</button>
            </div>
        </div>
        <style>
        @keyframes logoSpin {
            0%, 100% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(5deg) scale(1.05); }
        }
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        </style>

        <div class="card">
            <div class="card-header">TRADING INPUTS</div>
            <div class="input-grid">
                <div class="input-group">
                    <label>Win Rate %</label>
                    <input type="number" id="winPct" value="55" step="0.1" min="0" max="100">
                </div>
                <div class="input-group">
                    <label>Avg Win ($)</label>
                    <input type="number" id="avgWin" value="450" step="1" min="0">
                </div>
                <div class="input-group">
                    <label>Avg Loss ($)</label>
                    <input type="number" id="avgLoss" value="225" step="1" min="0">
                </div>
                <div class="input-group">
                    <label>Account ($)</label>
                    <input type="number" id="account" value="4500" step="1" min="0">
                </div>
                <div class="input-group">
                    <label>Risk/Trade ($)</label>
                    <input type="number" id="riskPerTrade" value="225" step="1" min="0">
                </div>
                <div class="input-group">
                    <label># Trades</label>
                    <input type="number" id="numTrades" value="200" step="1" min="1">
                </div>
                <div class="input-group">
                    <label>Avg MAE ($)</label>
                    <input type="number" id="avgMAE" value="150" step="1" min="0">
                </div>
                <div class="input-group">
                    <label>Avg MFE ($)</label>
                    <input type="number" id="avgMFE" value="650" step="1" min="0">
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">PERFORMANCE METRICS</div>
            <div class="metrics-grid" id="metricsGrid"></div>
            <div class="grade-grid">
                <div class="grade-box">
                    <div class="grade-title">üìä SYSTEM GRADES</div>
                    <div id="gradesContainer"></div>
                </div>
                <div class="grade-box">
                    <div class="grade-title">üí° POSITION SIZING</div>
                    <div id="adviceContainer" style="font-size: 14px; line-height: 1.9;"></div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="tab-container">
                <button class="tab active" onclick="switchTab(event, 'equity')">üìà Equity</button>
                <button class="tab" onclick="switchTab(event, 'drawdown')">üìâ Drawdown</button>
                <button class="tab" onclick="switchTab(event, 'distribution')">üìä Distribution</button>
                <button class="tab" onclick="switchTab(event, 'maemfe')">üéØ MAE/MFE</button>
            </div>
            <div class="chart-panel active" id="equity-panel">
                <div class="chart-container"><canvas id="equityChart"></canvas></div>
            </div>
            <div class="chart-panel" id="drawdown-panel">
                <div class="chart-container"><canvas id="drawdownChart"></canvas></div>
            </div>
            <div class="chart-panel" id="distribution-panel">
                <div class="chart-container"><canvas id="distributionChart"></canvas></div>
            </div>
            <div class="chart-panel" id="maemfe-panel">
                <div class="chart-container"><canvas id="maemfeChart"></canvas></div>
            </div>
        </div>

        <footer style="margin-top: 60px; text-align: center; padding: 30px; background: linear-gradient(135deg, rgba(30, 30, 30, 0.6) 0%, rgba(20, 20, 20, 0.6) 100%); backdrop-filter: blur(20px); border-radius: 20px; border: 1px solid rgba(200, 255, 0, 0.1); position: relative; overflow: hidden;">
            <div style="position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, #C8FF00, transparent); animation: scanline 2s linear infinite;"></div>
            <p style="font-size: 13px; color: #8B8B8B; font-weight: 500; letter-spacing: 1.5px; margin-bottom: 8px;">NQ RISK PROFILER v3.0</p>
            <p style="font-size: 11px; color: #4A4A4A; font-weight: 400; letter-spacing: 1px;">PROFESSIONAL TRADING ANALYTICS PLATFORM</p>
            <div style="margin-top: 15px; display: flex; justify-content: center; gap: 20px;">
                <div style="width: 40px; height: 3px; background: linear-gradient(90deg, #C8FF00, transparent); border-radius: 2px; animation: pulse 2s ease-in-out infinite;"></div>
                <div style="width: 40px; height: 3px; background: linear-gradient(90deg, #00FF88, transparent); border-radius: 2px; animation: pulse 2s ease-in-out 0.5s infinite;"></div>
                <div style="width: 40px; height: 3px; background: linear-gradient(90deg, #00C8FF, transparent); border-radius: 2px; animation: pulse 2s ease-in-out 1s infinite;"></div>
            </div>
        </footer>
        <style>
        @keyframes scanline {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        </style>
    </div>

    <script>
        let charts = {};

        function switchTab(event, tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.chart-panel').forEach(p => p.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab + '-panel').classList.add('active');
        }

        function calculate() {
            const winPct = parseFloat(document.getElementById('winPct').value);
            const avgWin = parseFloat(document.getElementById('avgWin').value);
            const avgLoss = parseFloat(document.getElementById('avgLoss').value);
            const account = parseFloat(document.getElementById('account').value);
            const riskPerTrade = parseFloat(document.getElementById('riskPerTrade').value);
            const numTrades = parseFloat(document.getElementById('numTrades').value);
            const avgMAE = parseFloat(document.getElementById('avgMAE').value);
            const avgMFE = parseFloat(document.getElementById('avgMFE').value);

            if (isNaN(winPct) || isNaN(avgWin) || isNaN(avgLoss) || isNaN(account) || isNaN(riskPerTrade) || isNaN(numTrades) || isNaN(avgMAE) || isNaN(avgMFE)) return;

            const winRate = winPct / 100;
            const lossPct = 1 - winRate;
            
            // Expected Value (EV) - Formula: EV = (Win% √ó AvgWin) ‚Äì (Loss% √ó AvgLoss)
            const EV = (winRate * avgWin) - (lossPct * avgLoss);
            
            // Profit Factor (PF) - Formula: PF = (Win% √ó AvgWin) √∑ (Loss% √ó AvgLoss)
            const denom = lossPct * avgLoss;
            const PF = denom === 0 ? (winRate * avgWin === 0 ? 1 : Infinity) : (winRate * avgWin) / denom;
            
            // Combined Edge for DISPLAY - Formula: CombinedEdge = EV √ó PF
            // This shows the overall system strength in dollar terms
            const CombinedEdge = EV * (isFinite(PF) ? PF : 1);
            
            // Bankroll Losses - Formula: Bankroll_Losses = Account √∑ Risk_per_trade
            const BankrollLosses = riskPerTrade === 0 ? Infinity : account / riskPerTrade;

            // For RoR calculation ONLY, we need normalized Combined Edge: EV_R √ó PF
            // Where EV_R = EV √∑ RiskPerTrade (this normalizes to R-multiples for RoR formula)
            const EV_R = riskPerTrade === 0 ? 0 : EV / riskPerTrade;
            const CombinedEdge_RoR = EV_R * (isFinite(PF) ? PF : 1);
            
            // Risk of Ruin (RoR) - Formula: RoR = ((1 ‚Äì CombinedEdge_RoR) √∑ (1 + CombinedEdge_RoR)) ^ Bankroll_Losses
            // Uses normalized CombinedEdge_RoR (not the display CombinedEdge)
            let RoR = 0;
            if (CombinedEdge_RoR >= 1) RoR = 0;
            else if (CombinedEdge_RoR <= -0.999) RoR = 1;
            else {
                const ratio = (1 - CombinedEdge_RoR) / (1 + CombinedEdge_RoR);
                if (ratio <= 0) RoR = 0;
                else RoR = Math.pow(ratio, BankrollLosses);
            }

            // Max Losing Streak - Formula: ln(N Trades) √∑ ln(1 √∑ Loss%)
            const lossRate = Math.max(1e-6, lossPct);
            const maxLosingStreak = Math.log(Math.max(2, numTrades)) / Math.log(1 / lossRate);
            const maxLS = Math.ceil(maxLosingStreak);
            const bufferedStreak = Math.ceil(maxLosingStreak * 1.5);
            
            // Risk Per Trade as % of account
            const riskPerTradePct = account === 0 ? 0 : (riskPerTrade / account) * 100;
            
            // Max Drawdown % - Using losing streak method: DD% ‚âà MaxLosingStreak √ó RiskPerTrade%
            const maxDrawdownPct = maxLS * riskPerTradePct;
            
            // DRR (Drawdown Risk Rating) - Formula: DRR = DD% √∑ RiskPerTrade%
            // Which simplifies to: DRR = (MaxLosingStreak √ó RiskPerTrade%) √∑ RiskPerTrade% = MaxLosingStreak
            const DRR = maxLS;

            // MAE/MFE Calculations
            const MAEMFERatio = avgMAE === 0 ? (avgMFE === 0 ? 1 : Infinity) : avgMFE / avgMAE;
            const MAEvsRiskPct = riskPerTrade === 0 ? 0 : (avgMAE / riskPerTrade) * 100;
            const MFEvsWinPct = avgWin === 0 ? 0 : (avgMFE / avgWin) * 100;
            
            // R-Multiple and SQN - Formula: SQN = (MeanR √∑ StdR) √ó ‚àöN
            const avgRMultiple = riskPerTrade === 0 ? 0 : EV / riskPerTrade;
            const stdRMultiple = 1.0; // Simplified for this calculator
            const SQN = numTrades === 0 ? 0 : (avgRMultiple / Math.max(0.01, stdRMultiple)) * Math.sqrt(numTrades);

            // Grading functions based on document specifications
            function gradeEV(val) {
                // A = EV > $100, B = $50‚Äì$100, C = $10‚Äì$50, D = $0‚Äì$10, F = negative
                if (val < 0) return 'F';
                if (val < 10) return 'D';
                if (val < 50) return 'C';
                if (val < 100) return 'B';
                return 'A';
            }

            function gradePF(val) {
                // A = 1.8‚Äì3.0, B = 1.4‚Äì1.79, C = 1.2‚Äì1.39, D = 1.0‚Äì1.19, F = < 1.0
                if (!isFinite(val)) return 'A';
                if (val < 1.0) return 'F';
                if (val < 1.2) return 'D';
                if (val < 1.4) return 'C';
                if (val < 1.8) return 'B';
                return 'A';
            }

            function gradeCE(val) {
                // Combined Edge = EV √ó PF, so scale is different
                // A = > 150, B = 100‚Äì150, C = 50‚Äì100, D = 20‚Äì50, F = < 20
                if (val < 20) return 'F';
                if (val < 50) return 'D';
                if (val < 100) return 'C';
                if (val < 150) return 'B';
                return 'A';
            }

            function gradeRoR(val) {
                // RoR < 1%: professional, 1‚Äì5%: acceptable, 5‚Äì20%: dangerous, 20%+: lethal
                if (val > 0.20) return 'F';
                if (val > 0.05) return 'D';
                if (val > 0.01) return 'C';
                if (val > 0.005) return 'B';
                return 'A';
            }

            function gradeMaxLS(val) {
                // Based on typical expectations - even good systems see 6-10 losses
                if (val >= 15) return 'F';
                if (val >= 12) return 'D';
                if (val >= 10) return 'C';
                if (val >= 7) return 'B';
                return 'A';
            }

            function gradeMAEMFE(val) {
                // 2.0+ = strong, 1.0-2.0 = normal, <1.0 = weak
                if (val < 1.0) return 'F';
                if (val < 1.5) return 'D';
                if (val < 2.0) return 'C';
                if (val < 2.5) return 'B';
                return 'A';
            }

            function gradeSQN(val) {
                // A = ‚â•3.0, B = 2.5‚Äì2.99, C = 2.0‚Äì2.49, D = 1.5‚Äì1.99, F = <1.5
                if (val < 1.5) return 'F';
                if (val < 2.0) return 'D';
                if (val < 2.5) return 'C';
                if (val < 3.0) return 'B';
                return 'A';
            }
            
            function gradeDRR(val) {
                // DRR ‚â§ 4: very healthy, 4‚Äì7: okay, 7‚Äì10: high risk, 10+: dangerous
                if (val > 10) return 'F';
                if (val > 7) return 'D';
                if (val > 4) return 'C';
                if (val > 2) return 'B';
                return 'A';
            }

            const evGrade = gradeEV(EV);
            const pfGrade = gradePF(PF);
            const ceGrade = gradeCE(CombinedEdge);
            const rorGrade = gradeRoR(RoR);
            const lsGrade = gradeMaxLS(maxLS);
            const maemfeGrade = gradeMAEMFE(MAEMFERatio);
            const sqnGrade = gradeSQN(SQN);
            const drrGrade = gradeDRR(DRR);

            document.getElementById('metricsGrid').innerHTML = `
                <div class="metric-box"><div class="metric-label">EV PER TRADE</div><div class="metric-value">$${EV.toFixed(2)}</div></div>
                <div class="metric-box"><div class="metric-label">PROFIT FACTOR</div><div class="metric-value">${isFinite(PF) ? PF.toFixed(2) : '‚àû'}</div></div>
                <div class="metric-box"><div class="metric-label">COMBINED EDGE</div><div class="metric-value">${CombinedEdge.toFixed(2)}</div></div>
                <div class="metric-box"><div class="metric-label">RISK OF RUIN</div><div class="metric-value">${(RoR * 100).toFixed(3)}%</div></div>
                <div class="metric-box"><div class="metric-label">MAX LOSING STREAK</div><div class="metric-value">${maxLS}</div></div>
                <div class="metric-box"><div class="metric-label">RISK % PER TRADE</div><div class="metric-value">${riskPerTradePct.toFixed(2)}%</div></div>
                <div class="metric-box"><div class="metric-label">MAX DRAWDOWN</div><div class="metric-value">${maxDrawdownPct.toFixed(1)}%</div></div>
                <div class="metric-box"><div class="metric-label">BANKROLL LOSSES</div><div class="metric-value">${isFinite(BankrollLosses) ? BankrollLosses.toFixed(1) : '‚àû'}</div></div>
                <div class="metric-box"><div class="metric-label">DRR</div><div class="metric-value">${DRR.toFixed(1)}</div></div>
                <div class="metric-box"><div class="metric-label">BUFFERED STREAK</div><div class="metric-value">${bufferedStreak}</div></div>
                <div class="metric-box"><div class="metric-label">MAE/MFE RATIO</div><div class="metric-value">${isFinite(MAEMFERatio) ? MAEMFERatio.toFixed(2) : '‚àû'}</div></div>
                <div class="metric-box"><div class="metric-label">MAE vs RISK</div><div class="metric-value">${MAEvsRiskPct.toFixed(1)}%</div></div>
                <div class="metric-box"><div class="metric-label">MFE vs AVG WIN</div><div class="metric-value">${MFEvsWinPct.toFixed(1)}%</div></div>
                <div class="metric-box"><div class="metric-label">SQN</div><div class="metric-value">${SQN.toFixed(2)}</div></div>
                <div class="metric-box"><div class="metric-label">AVG R-MULTIPLE</div><div class="metric-value">${avgRMultiple.toFixed(3)}</div></div>
            `;

            document.getElementById('gradesContainer').innerHTML = `
                <div class="grade-item"><span>Expected Value</span><strong class="grade-${evGrade.toLowerCase()}">${evGrade}</strong></div>
                <div class="grade-item"><span>Profit Factor</span><strong class="grade-${pfGrade.toLowerCase()}">${pfGrade}</strong></div>
                <div class="grade-item"><span>Combined Edge</span><strong class="grade-${ceGrade.toLowerCase()}">${ceGrade}</strong></div>
                <div class="grade-item"><span>Risk of Ruin</span><strong class="grade-${rorGrade.toLowerCase()}">${rorGrade}</strong></div>
                <div class="grade-item"><span>Max Losing Streak</span><strong class="grade-${lsGrade.toLowerCase()}">${lsGrade}</strong></div>
                <div class="grade-item"><span>DRR</span><strong class="grade-${drrGrade.toLowerCase()}">${drrGrade}</strong></div>
                <div class="grade-item"><span>MAE/MFE Ratio</span><strong class="grade-${maemfeGrade.toLowerCase()}">${maemfeGrade}</strong></div>
                <div class="grade-item"><span>SQN</span><strong class="grade-${sqnGrade.toLowerCase()}">${sqnGrade}</strong></div>
            `;

            let advice = '';
            let adviceColor = '';
            let extraInsights = '';

            if (MAEvsRiskPct < 50) {
                extraInsights += '<br><br>üéØ <strong style="color: #3b82f6;">STOP OPTIMIZATION:</strong> Your MAE is only ' + MAEvsRiskPct.toFixed(1) + '% of your risk. Consider tightening stops to improve risk efficiency.';
            } else if (MAEvsRiskPct > 90) {
                extraInsights += '<br><br>‚ö†Ô∏è <strong style="color: #f59e0b;">STOP WARNING:</strong> Your MAE is ' + MAEvsRiskPct.toFixed(1) + '% of your risk. Stops may be too tight, giving trades insufficient room.';
            }

            if (MFEvsWinPct > 150) {
                extraInsights += '<br><br>üí∞ <strong style="color: #10b981;">EXIT OPPORTUNITY:</strong> Your MFE is ' + MFEvsWinPct.toFixed(1) + '% of avg win. You\'re leaving significant profit on the table - adjust targets or scaling strategy.';
            } else if (MFEvsWinPct > 90 && MFEvsWinPct < 110) {
                extraInsights += '<br><br>‚úÖ <strong style="color: #10b981;">EFFICIENT EXITS:</strong> Your exits capture ' + MFEvsWinPct.toFixed(1) + '% of available moves. Well optimized!';
            }

            if (SQN >= 3.0) {
                extraInsights += '<br><br>üèÜ <strong style="color: #a78bfa;">ELITE SYSTEM:</strong> SQN of ' + SQN.toFixed(2) + ' indicates institutional-grade quality. This system has exceptional consistency.';
            } else if (SQN < 1.5) {
                extraInsights += '<br><br>‚ùå <strong style="color: #ef4444;">POOR SQN:</strong> SQN of ' + SQN.toFixed(2) + ' suggests unreliable edge. Focus on improving consistency before scaling.';
            }

            // Position sizing based on overall system grade
            let overallGrade = 'F';
            let riskRecommendation = '0% (Do not trade)';
            
            // Calculate overall grade based on key metrics
            const gradeValues = { 'A': 4, 'B': 3, 'C': 2, 'D': 1, 'F': 0 };
            const avgGradeValue = (
                gradeValues[evGrade] + 
                gradeValues[pfGrade] + 
                gradeValues[ceGrade] + 
                gradeValues[rorGrade] + 
                gradeValues[sqnGrade]
            ) / 5;
            
            if (avgGradeValue >= 3.5) {
                overallGrade = 'A';
                riskRecommendation = '2‚Äì5% per trade';
            } else if (avgGradeValue >= 2.5) {
                overallGrade = 'B';
                riskRecommendation = '1‚Äì2% per trade';
            } else if (avgGradeValue >= 1.5) {
                overallGrade = 'C';
                riskRecommendation = '0.5‚Äì1% per trade';
            } else if (avgGradeValue >= 0.5) {
                overallGrade = 'D';
                riskRecommendation = '0.25‚Äì0.5% per trade';
            }

            if (overallGrade === 'A') {
                advice = '<strong style="color: #10b981; font-size: 16px;">‚úÖ GRADE A SYSTEM</strong><br><br><strong>Position Size:</strong> ' + riskRecommendation + '<br><br>This system shows professional-grade metrics with excellent risk-adjusted returns. Strong edge, high consistency, and manageable risk.' + extraInsights;
                adviceColor = 'rgba(16, 185, 129, 0.15)';
            } else if (overallGrade === 'B') {
                advice = '<strong style="color: #3b82f6; font-size: 16px;">‚úì GRADE B SYSTEM</strong><br><br><strong>Position Size:</strong> ' + riskRecommendation + '<br><br>Solid system with decent edge. Risk management is critical. Monitor drawdowns closely.' + extraInsights;
                adviceColor = 'rgba(59, 130, 246, 0.15)';
            } else if (overallGrade === 'C') {
                advice = '<strong style="color: #f59e0b; font-size: 16px;">‚ö†Ô∏è GRADE C SYSTEM</strong><br><br><strong>Position Size:</strong> ' + riskRecommendation + '<br><br>Marginal system. Keep position sizes very small while improving metrics. Focus on increasing EV and PF.' + extraInsights;
                adviceColor = 'rgba(245, 158, 11, 0.15)';
            } else if (overallGrade === 'D') {
                advice = '<strong style="color: #f97316; font-size: 16px;">‚ùå GRADE D SYSTEM</strong><br><br><strong>Position Size:</strong> ' + riskRecommendation + '<br><br>Weak system. Paper trade only or drastically reduce risk. Major improvements needed before scaling.' + extraInsights;
                adviceColor = 'rgba(249, 115, 22, 0.15)';
            } else {
                advice = '<strong style="color: #ef4444; font-size: 16px;">‚ùå GRADE F SYSTEM</strong><br><br><strong>Position Size:</strong> ' + riskRecommendation + '<br><br>DO NOT TRADE with real money. This system lacks edge. Rework strategy fundamentals before risking capital.' + extraInsights;
                adviceColor = 'rgba(239, 68, 68, 0.15)';
            }
            
            document.getElementById('adviceContainer').innerHTML = '<div style="padding: 16px; background: ' + adviceColor + '; border-radius: 12px; line-height: 1.9; border: 2px solid ' + adviceColor.replace('0.15', '0.3') + ';">' + advice + '</div>';

            renderEquityChart(EV, account);
            renderDrawdownChart(maxLS, riskPerTrade, account);
            renderDistributionChart(winRate, avgWin, avgLoss);
            renderMAEMFEChart(riskPerTrade, avgMAE, avgWin, avgMFE);
        }

        function renderEquityChart(EV, account) {
            const data = [];
            let cum = account;
            for (let i = 0; i <= 50; i++) {
                data.push({ x: i, y: Math.round(cum) });
                cum += EV;
            }
            if (charts.equity) charts.equity.destroy();
            const ctx = document.getElementById('equityChart').getContext('2d');
            charts.equity = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Equity',
                        data: data,
                        backgroundColor: 'rgba(200, 255, 0, 0.1)',
                        borderColor: '#C8FF00',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        pointHoverBackgroundColor: '#C8FF00',
                        pointHoverBorderColor: '#000',
                        pointHoverBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { intersect: false, mode: 'index' },
                    scales: {
                        x: {
                            type: 'linear',
                            title: { display: true, text: 'TRADE NUMBER', color: '#8B8B8B', font: { size: 12, weight: 'bold' } },
                            ticks: { color: '#4A4A4A', font: { size: 11 } },
                            grid: { color: 'rgba(200, 255, 0, 0.05)' }
                        },
                        y: {
                            title: { display: true, text: 'ACCOUNT VALUE ($)', color: '#8B8B8B', font: { size: 12, weight: 'bold' } },
                            ticks: { color: '#4A4A4A', font: { size: 11 } },
                            grid: { color: 'rgba(200, 255, 0, 0.05)' }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.95)',
                            titleColor: '#C8FF00',
                            bodyColor: '#fff',
                            borderColor: '#C8FF00',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            titleFont: { size: 13, weight: 'bold' },
                            bodyFont: { size: 12 }
                        }
                    }
                }
            });
        }

        function renderDrawdownChart(maxLS, riskPerTrade, account) {
            const data = [];
            let equity = account;
            for (let i = 0; i <= maxLS; i++) {
                data.push({ x: i, y: parseFloat(((equity - account) / account * 100).toFixed(2)) });
                equity -= riskPerTrade;
            }
            const recoveryTrades = Math.ceil(maxLS * 0.7);
            for (let i = 1; i <= recoveryTrades; i++) {
                equity += riskPerTrade * 1.5;
                data.push({ x: maxLS + i, y: parseFloat(((equity - account) / account * 100).toFixed(2)) });
            }
            if (charts.drawdown) charts.drawdown.destroy();
            const ctx = document.getElementById('drawdownChart').getContext('2d');
            charts.drawdown = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Drawdown %',
                        data: data,
                        backgroundColor: 'rgba(255, 50, 50, 0.1)',
                        borderColor: '#FF3232',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.3,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        pointHoverBackgroundColor: '#FF3232',
                        pointHoverBorderColor: '#000',
                        pointHoverBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { intersect: false, mode: 'index' },
                    scales: {
                        x: {
                            type: 'linear',
                            title: { display: true, text: 'TRADE NUMBER', color: '#8B8B8B', font: { size: 12, weight: 'bold' } },
                            ticks: { color: '#4A4A4A', font: { size: 11 } },
                            grid: { color: 'rgba(200, 255, 0, 0.05)' }
                        },
                        y: {
                            title: { display: true, text: 'DRAWDOWN %', color: '#8B8B8B', font: { size: 12, weight: 'bold' } },
                            ticks: { color: '#4A4A4A', font: { size: 11 } },
                            grid: { color: 'rgba(200, 255, 0, 0.05)' }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.95)',
                            titleColor: '#FF3232',
                            bodyColor: '#fff',
                            borderColor: '#FF3232',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            titleFont: { size: 13, weight: 'bold' },
                            bodyFont: { size: 12 }
                        }
                    }
                }
            });
        }

        function renderDistributionChart(winRate, avgWin, avgLoss) {
            if (charts.distribution) charts.distribution.destroy();
            const ctx = document.getElementById('distributionChart').getContext('2d');
            charts.distribution = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['WINS (' + (winRate * 100).toFixed(1) + '%)', 'LOSSES (' + ((1-winRate) * 100).toFixed(1) + '%)'],
                    datasets: [{
                        label: 'FREQUENCY (%)',
                        data: [winRate * 100, (1 - winRate) * 100],
                        backgroundColor: ['rgba(200, 255, 0, 0.8)', 'rgba(255, 50, 50, 0.8)'],
                        borderColor: ['#C8FF00', '#FF3232'],
                        borderWidth: 2
                    }, {
                        label: 'AVG AMOUNT ($)',
                        data: [avgWin, avgLoss],
                        backgroundColor: ['rgba(200, 255, 0, 0.5)', 'rgba(255, 50, 50, 0.5)'],
                        borderColor: ['#C8FF00', '#FF3232'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            title: { display: true, text: 'VALUE', color: '#8B8B8B', font: { size: 12, weight: 'bold' } },
                            ticks: { color: '#4A4A4A', font: { size: 11 } },
                            grid: { color: 'rgba(200, 255, 0, 0.05)' }
                        },
                        x: {
                            ticks: { color: '#8B8B8B', font: { size: 11, weight: 'bold' } },
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: { 
                            display: true,
                            labels: { color: '#8B8B8B', font: { size: 12, weight: 'bold' }, padding: 15 }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.95)',
                            titleColor: '#C8FF00',
                            bodyColor: '#fff',
                            borderColor: '#C8FF00',
                            borderWidth: 1,
                            padding: 12,
                            titleFont: { size: 13, weight: 'bold' },
                            bodyFont: { size: 12 }
                        }
                    }
                }
            });
        }

        function renderMAEMFEChart(riskPerTrade, avgMAE, avgWin, avgMFE) {
            if (charts.maemfe) charts.maemfe.destroy();
            const ctx = document.getElementById('maemfeChart').getContext('2d');
            charts.maemfe = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Risk/Trade', 'Avg MAE', 'Avg Win', 'Avg MFE'],
                    datasets: [{
                        label: 'Amount ($)',
                        data: [riskPerTrade, avgMAE, avgWin, avgMFE],
                        backgroundColor: [
                            'rgba(139, 139, 139, 0.8)',
                            'rgba(255, 50, 50, 0.8)',
                            'rgba(200, 255, 0, 0.8)',
                            'rgba(0, 200, 255, 0.8)'
                        ],
                        borderColor: ['#8B8B8B', '#FF3232', '#C8FF00', '#00C8FF'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'AMOUNT ($)', color: '#8B8B8B', font: { size: 12, weight: 'bold' } },
                            ticks: { color: '#4A4A4A', font: { size: 11 } },
                            grid: { color: 'rgba(200, 255, 0, 0.05)' }
                        },
                        x: {
                            ticks: { color: '#8B8B8B', font: { size: 11, weight: 'bold' } },
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.95)',
                            titleColor: '#C8FF00',
                            bodyColor: '#fff',
                            borderColor: '#C8FF00',
                            borderWidth: 1,
                            padding: 12,
                            titleFont: { size: 13, weight: 'bold' },
                            bodyFont: { size: 12 },
                            callbacks: {
                                afterLabel: function(context) {
                                    const labels = [
                                        'Your stop loss amount',
                                        'How far against you (heat)',
                                        'Your average profit captured',
                                        'Best profit available'
                                    ];
                                    return labels[context.dataIndex];
                                }
                            }
                        }
                    }
                }
            });
        }

        function exportResults() {
            const winPct = document.getElementById('winPct').value;
            const avgWin = document.getElementById('avgWin').value;
            const avgLoss = document.getElementById('avgLoss').value;
            const account = document.getElementById('account').value;
            const riskPerTrade = document.getElementById('riskPerTrade').value;
            const numTrades = document.getElementById('numTrades').value;
            const avgMAE = document.getElementById('avgMAE').value;
            const avgMFE = document.getElementById('avgMFE').value;
            
            // Get all calculated metrics from the DOM
            const metricsText = document.getElementById('metricsGrid').innerText;
            const gradesText = document.getElementById('gradesContainer').innerText;
            const adviceText = document.getElementById('adviceContainer').innerText.replace(/<[^>]*>/g, '');
            
            // Create CSV content for Excel
            const csvContent = `NQ RISK PROFILER EXPORT
Generated: ${new Date().toLocaleString()}

TRADING INPUTS
Win Rate %,${winPct}
Average Win ($),${avgWin}
Average Loss ($),${avgLoss}
Account Size ($),${account}
Risk per Trade ($),${riskPerTrade}
Number of Trades,${numTrades}
Average MAE ($),${avgMAE}
Average MFE ($),${avgMFE}

PERFORMANCE METRICS
${metricsText.split('\n').map(line => line.trim()).filter(line => line).join('\n')}

SYSTEM GRADES
${gradesText.split('\n').map(line => line.trim()).filter(line => line).join('\n')}

POSITION SIZING ADVICE
${adviceText.split('\n').map(line => line.trim()).filter(line => line).join('\n')}
`;
            
            // Create blob and download
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'nq-risk-profile-' + new Date().getTime() + '.csv';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            // Show success message
            showNotification('‚úÖ Results exported successfully as CSV/Excel file!');
        }
        
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #C8FF00, #00FF88);
                color: #000;
                padding: 16px 24px;
                border-radius: 12px;
                font-weight: 600;
                font-size: 14px;
                box-shadow: 0 8px 32px rgba(200, 255, 0, 0.4);
                z-index: 10000;
                animation: slideInRight 0.3s ease-out;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-out';
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }
        
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(400px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(400px); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        function reset() {
            document.getElementById('winPct').value = 55;
            document.getElementById('avgWin').value = 450;
            document.getElementById('avgLoss').value = 225;
            document.getElementById('account').value = 4500;
            document.getElementById('riskPerTrade').value = 225;
            document.getElementById('numTrades').value = 200;
            document.getElementById('avgMAE').value = 150;
            document.getElementById('avgMFE').value = 650;
            calculate();
        }

        window.addEventListener('DOMContentLoaded', function() {
            const inputs = ['winPct', 'avgWin', 'avgLoss', 'account', 'riskPerTrade', 'numTrades', 'avgMAE', 'avgMFE'];
            inputs.forEach(id => {
                const elem = document.getElementById(id);
                if (elem) {
                    let typingTimer;
                    const doneTypingInterval = 500;
                    elem.addEventListener('input', function() {
                        clearTimeout(typingTimer);
                    });
                    elem.addEventListener('keyup', function() {
                        clearTimeout(typingTimer);
                        typingTimer = setTimeout(calculate, doneTypingInterval);
                    });
                    elem.addEventListener('blur', function() {
                        clearTimeout(typingTimer);
                        calculate();
                    });
                }
            });
            calculate();
        });
    </script>
</body>
</html>